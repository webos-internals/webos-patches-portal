if(typeof window==="undefined")window={};window.persistence=window&&window.persistence?window.persistence:createPersistence();if(typeof exports!=="undefined"){exports.createPersistence=createPersistence;exports.persistence=persistence}
function createPersistence(){var b={};b.isImmutable=function(H){return H=="id"};b.defineProp=function(H,I,N,L){H.__defineSetter__(I,function(u){N(u)});H.__defineGetter__(I,function(){return L()})};b.set=function(H,I,N){if(b.isImmutable(I))throw new Error("immutable field: "+I);H[I]=N};b.get=function(H,I){return arguments.length==1?H:H[I]};(function(){function H(a){return F[a]}function I(a){this.trackedObjects={};this.objectsToRemove={};this.objectsRemoved=[];this.globalPropertyListeners={};this.queryCollectionCache=
{};this.conn=a}function N(a){function c(j,n){var q=C.getArgs(arguments,[{name:"session",optional:true,check:b.isSession,defaultValue:b},{name:"obj",optional:true,check:function(p){return p},defaultValue:{}}]);if(g.isMixin)throw new Error("Cannot instantiate mixin");j=q.session;n=q.obj;var k=this;this.id=b.createUUID();this._new=true;this._type=a;this._dirtyProperties={};this._data={};this._data_obj={};this._session=j||b;this.subscribers={};for(var x in g.fields)(function(){if(g.fields.hasOwnProperty(x)){var p=
x;b.defineProp(k,p,function(v){var s=k._data[p];if(s!==v||s&&v&&s.getTime&&v.getTime){k._data[p]=v;k._dirtyProperties[p]=s;k.triggerEvent("set",k,p,v);k.triggerEvent("change",k,p,v);j.propertyChanged(k,p,s,v)}},function(){return k._data[p]});k._data[x]=u(g.fields[x])}})();for(var z in g.hasOne)g.hasOne.hasOwnProperty(z)&&function(){var p=z,v=g.hasOne[z].type.meta.isMixin?p+"_class":null;b.defineProp(k,p,function(s){var M=k._data[p];if(s==null){k._data[p]=null;k._data_obj[p]=undefined;if(v)k[v]=""}else if(s.id){k._data[p]=
s.id;k._data_obj[p]=s;if(v)k[v]=s._type;j.add(s);j.add(k)}else k._data[p]=s;k._dirtyProperties[p]=M;k.triggerEvent("set",k,p,s);k.triggerEvent("change",k,p,s)},function(){if(k._data[p])if(k._data_obj[p]!==undefined)return k._data_obj[p];else if(k._data[p]&&j.trackedObjects[k._data[p]]){k._data_obj[p]=j.trackedObjects[k._data[p]];return k._data_obj[p]}else throw new Error("Property '"+p+"' with id: "+k._data[p]+" not fetched, either prefetch it or fetch it manually.");else return null})}();for(z in g.hasMany)g.hasMany.hasOwnProperty(z)&&
function(){var p=z;g.hasMany[p].manyToMany?b.defineProp(k,p,function(v){if(v&&v._items){v=v._items;for(var s=0;s<v.length;s++)b.get(k,p).add(v[s])}else throw new Error("Not yet supported.");},function(){if(k._data[p])return k._data[p];else{var v=g.hasMany[p],s=v.type.meta,M=s.hasMany[v.inverseProperty],O=v.mixin?v.mixin.meta.name:g.name;M=M.mixin?M.mixin.meta.name:s.name;s=new b.ManyToManyDbQueryCollection(j,s.name);s.initManyToMany(k,p);s._manyToManyFetch={table:v.tableName,prop:O+"_"+p,inverseProp:M+
"_"+v.inverseProperty,id:k.id};k._data[p]=s;return j.uniqueQueryCollection(s)}}):b.defineProp(k,p,function(v){if(v&&v._items){v=v._items;for(var s=0;s<v.length;s++)b.get(k,p).add(v[s])}else throw new Error("Not yet supported.");},function(){if(k._data[p])return k._data[p];else{var v=j.uniqueQueryCollection((new b.DbQueryCollection(j,g.hasMany[p].type.meta.name)).filter(g.hasMany[p].inverseProperty,"=",k));return k._data[p]=v}})}();for(var w in n)n.hasOwnProperty(w)&&b.set(k,w,n[w])}function h(j,n,
q,k){var x=j._session,z=[],w=H(j._type),p=w.fields;for(var v in q)q.hasOwnProperty(v)&&z.push(v);var s=[],M=[];z.forEach(function(J){q[J]===true&&!w.hasMany[J]?s.push(J):M.push(J)});var O=j._data,P={};s.forEach(function(J){if(J==="id")P.id=j.id;else P[J]=w.hasOne[J]?O[J]?{id:O[J]}:null:b.entityValToJson(O[J],p[J])});z=M.slice();b.asyncForEach(z,function(J,Q){if(w.hasOne[J])j.fetch(x,n,J,function(S){if(S)h(S,n,q[J],function(R){P[J]=R;Q()});else{P[J]=null;Q()}});else w.hasMany[J]&&b.get(j,J).list(function(S){P[J]=
[];b.asyncForEach(S,function(R,T){R=S.pop();if(q[J]===true){P[J].push({id:R.id});T()}else h(R,n,q[J],function(U){P[J].push(U);T()})},Q)})},function(){k(P)})}if(K[a])return K[a];var g=F[a];c.prototype=new d;c.meta=g;c.prototype.equals=function(j){return this.id==j.id};c.prototype.toJSON=function(){var j={id:this.id};for(var n in this._data)if(this._data.hasOwnProperty(n))if(typeof this._data[n]=="object"&&this._data[n]!=null){if(this._data[n].toJSON!=undefined)j[n]=this._data[n].toJSON()}else j[n]=
this._data[n];return j};c.prototype.selectJSON=function(j,n,q){var k=this,x=C.getArgs(arguments,[{name:"tx",optional:true,check:b.isTransaction,defaultValue:null},{name:"props",optional:false},{name:"callback",optional:false}]);j=x.tx;n=x.props;q=x.callback;if(j){var z={};n.forEach(function(w){var p=z;w=w.split(".");for(var v=0;v<w.length;v++){var s=w[v];if(v===w.length-1)if(s==="*"){p.id=true;for(var M in g.fields)if(g.fields.hasOwnProperty(M))p[M]=true;for(M in g.hasOne)if(g.hasOne.hasOwnProperty(M))p[M]=
true;for(M in g.hasMany)if(g.hasMany.hasOwnProperty(M))p[M]=true}else if(s[0]==="["){s=s.substring(1,s.length-1);s.split(/,\s*/).forEach(function(O){p[O]=true})}else p[s]=true;else{p[s]=p[s]||{};p=p[s]}}});h(this,j,z,q)}else this._session.transaction(function(w){k.selectJSON(w,n,q)})};c.prototype.fetch=function(j,n,q,k){var x=C.getArgs(arguments,[{name:"session",optional:true,check:b.isSession,defaultValue:b},{name:"tx",optional:true,check:b.isTransaction,defaultValue:null},{name:"rel",optional:false,
check:C.hasType("string")},{name:"callback",optional:false,check:C.isCallback()}]);j=x.session;n=x.tx;q=x.rel;k=x.callback;var z=this;if(n)if(this._data[q])if(this._data_obj[q])k&&k(this._data_obj[q]);else{x=g.hasOne[q].type;if(x.meta.isMixin)x=N(this._data[q+"_class"]);x.load(j,n,this._data[q],function(w){z._data_obj[q]=w;k&&k(w)})}else k&&k(null);else j.transaction(function(w){z.fetch(j,w,q,k)})};c.prototype.markDirty=function(j){this._dirtyProperties[j]=true};c.all=function(j){j=j||b;return j.uniqueQueryCollection(new E(j,
a))};c.fromSelectJSON=function(j,n,q,k){function x(w){if(!w){w=new c;if(q.id)w.id=q.id}j.add(w);var p=[];for(var v in q)if(q.hasOwnProperty(v))if(v!=="id")if(g.fields[v])b.set(w,v,b.jsonToEntityVal(q[v],g.fields[v]));else if(g.hasOne[v]||g.hasMany[v])p.push(v);b.asyncForEach(p,function(s,M){if(g.hasOne[s])g.hasOne[s].type.fromSelectJSON(j,n,q[s],function(Q){b.set(w,s,Q);M()});else if(g.hasMany[s]){var O=b.get(w,s),P=q[s].slice(0),J=g.hasMany[s].type;O.list(n,function(Q){b.asyncForEach(P,function(S,
R){J.fromSelectJSON(j,n,S,function(T){for(var U=0;U<Q.length;U++)if(Q[U].id===T.id){R();return}O.add(T);R()})},function(){M()})})}},function(){k(w)})}var z=C.getArgs(arguments,[{name:"session",optional:true,check:b.isSession,defaultValue:b},{name:"tx",optional:true,check:b.isTransaction,defaultValue:null},{name:"jsonObj",optional:false},{name:"callback",optional:false,check:C.isCallback()}]);j=z.session;n=z.tx;q=z.jsonObj;k=z.callback;if(n){if(typeof q==="string")q=JSON.parse(q);if(q)q.id?c.load(j,
n,q.id,x):x(new c);else k(null)}else j.transaction(function(w){c.fromSelectJSON(j,w,q,k)})};c.load=function(){var j=C.getArgs(arguments,[{name:"session",optional:true,check:b.isSession,defaultValue:b},{name:"tx",optional:true,check:b.isTransaction,defaultValue:null},{name:"id",optional:false,check:C.hasType("string")},{name:"callback",optional:true,check:C.isCallback(),defaultValue:function(){}}]);c.findBy(j.session,j.tx,"id",j.id,j.callback)};c.findBy=function(j,n,q,k,x){var z=C.getArgs(arguments,
[{name:"session",optional:true,check:b.isSession,defaultValue:b},{name:"tx",optional:true,check:b.isTransaction,defaultValue:null},{name:"property",optional:false,check:C.hasType("string")},{name:"value",optional:false},{name:"callback",optional:true,check:C.isCallback(),defaultValue:function(){}}]);j=z.session;n=z.tx;q=z.property;k=z.value;x=z.callback;if(q==="id"&&k in j.trackedObjects)x(j.trackedObjects[k]);else n?c.all(j).filter(q,"=",k).one(n,function(w){x(w)}):j.transaction(function(w){c.findBy(j,
w,q,k,x)})};c.index=function(j,n){n=n||{};if(typeof j=="string")j=[j];n.columns=j;g.indexes.push(n)};c.hasMany=function(j,n,q){var k=n.meta;if(k.hasMany[q]){var x=g.name+"_"+j+"_"+k.name,z=k.name+"_"+q+"_"+g.name;if(x>z)x=z;g.hasMany[j]={type:n,inverseProperty:q,manyToMany:true,tableName:x};k.hasMany[q]={type:c,inverseProperty:j,manyToMany:true,tableName:x};delete g.hasOne[j];delete g.fields[j+"_class"]}else{g.hasMany[j]={type:n,inverseProperty:q};k.hasOne[q]={type:c,inverseProperty:j};if(g.isMixin)k.fields[q+
"_class"]=b.typeMapper?b.typeMapper.classNameType:"TEXT"}};c.hasOne=function(j,n){g.hasOne[j]={type:n};if(n.meta.isMixin)g.fields[j+"_class"]=b.typeMapper?b.typeMapper.classNameType:"TEXT"};c.is=function(j){var n=j.meta;if(!n.isMixin)throw new Error("not a mixin: "+j);j.meta.mixedIns=j.meta.mixedIns||[];j.meta.mixedIns.push(g);for(var q in n.fields)if(n.fields.hasOwnProperty(q))g.fields[q]=n.fields[q];for(var k in n.hasOne)if(n.hasOne.hasOwnProperty(k))g.hasOne[k]=n.hasOne[k];for(k in n.hasMany)if(n.hasMany.hasOwnProperty(k)){n.hasMany[k].mixin=
j;g.hasMany[k]=n.hasMany[k]}};for(var y=b.entityDecoratorHooks,G=0;G<y.length;G++)y[G](c);return K[a]=c}function L(){if(b.typeMapper&&b.typeMapper.newUuid)return b.typeMapper.newUuid();for(var a=[],c=0;c<32;c++)a[c]="0123456789ABCDEF".substr(Math.floor(Math.random()*16),1);a[12]="4";a[16]="0123456789ABCDEF".substr(a[16]&3|8,1);return a.join("")}function u(a){if(b.typeMapper&&b.typeMapper.defaultValue)return b.typeMapper.defaultValue(a);switch(a){case "TEXT":return"";case "BOOL":return false;default:return a.indexOf("INT")!==
-1?0:a.indexOf("CHAR")!==-1?"":null}}function A(a,c){for(var h=a.length,g=0;g<h;g++){var y=a[g];if(y.equals&&y.equals(c))return true;else if(y===c)return true}return false}function t(a,c){for(var h=a.length,g=0;g<h;g++){var y=a[g];if(y.equals&&y.equals(c))a.splice(g,1);else y===c&&a.splice(g,1)}}function r(a,c,h){this.obj=a;this.eventType=c;this.fn=h}function d(){this.subscribers={}}function e(){}function l(a,c){this.left=a;this.right=c}function m(a,c){this.left=a;this.right=c}function f(a,c,h){this.property=
a;this.operator=c.toLowerCase();this.value=h}function i(){}function o(a,c){this.init(a,c,o)}function E(a,c){this.init(a,c,E)}function B(a,c){this.init(a,c,b.ManyToManyDbQueryCollection);this._localAdded=[];this._localRemoved=[]}function D(a){this.init(b,null,D);this._items=a||[]}var F={},K={};b.getEntityMeta=function(){return F};b.trackedObjects={};b.objectsToRemove={};b.objectsRemoved=[];b.globalPropertyListeners={};b.queryCollectionCache={};b.getObjectsToRemove=function(){return this.objectsToRemove};
b.getTrackedObjects=function(){return this.trackedObjects};b.entityDecoratorHooks=[];b.flushHooks=[];b.schemaSyncHooks=[];b.debug=true;b.subscribeToGlobalPropertyListener=function(a,c,h){c=c+"__"+h;if(c in this.globalPropertyListeners){h=this.globalPropertyListeners[c];for(var g=0;g<h.length;g++)if(h[g]===a)return;this.globalPropertyListeners[c].push(a)}else this.globalPropertyListeners[c]=[a]};b.unsubscribeFromGlobalPropertyListener=function(a,c,h){c=this.globalPropertyListeners[c+"__"+h];for(h=
0;h<c.length;h++)if(c[h]===a){c.splice(h,1);return}};b.propertyChanged=function(a,c,h,g){if(this.trackedObjects[a.id]){var y=a._type+"__"+c;if(y in this.globalPropertyListeners){y=this.globalPropertyListeners[y];for(var G=0;G<y.length;G++){var j=y[G],n=a._data;n[c]=h;var q=j._filter.match(n);n[c]=g;n=j._filter.match(n);q!=n&&j.triggerEvent("change",j,a)}}}};b.objectRemoved=function(a){var c=a._type;if(this.queryCollectionCache[c]){c=this.queryCollectionCache[c];for(var h in c)if(c.hasOwnProperty(h)){var g=
c[h];g._filter.match(a)&&g.triggerEvent("change",g,a)}}};b.getMeta=H;I.prototype=b;b.Session=I;b.define=function(a,c){if(F[a])return N(a);F[a]={name:a,fields:c,isMixin:false,indexes:[],hasMany:{},hasOne:{}};return N(a)};b.isDefined=function(a){return!!F[a]};b.defineMixin=function(a,c){a=this.define(a,c);a.meta.isMixin=true;return a};b.isTransaction=function(a){return!a||a&&a.executeSql};b.isSession=function(a){return!a||a&&a.schemaSync};b.add=function(a){if(a){if(!this.trackedObjects[a.id]){this.trackedObjects[a.id]=
a;if(a._new)for(var c in a._data)a._data.hasOwnProperty(c)&&this.propertyChanged(a,c,undefined,a._data[c])}return this}};b.remove=function(a){this.objectsToRemove[a.id]||(this.objectsToRemove[a.id]=a);this.objectsRemoved.push({id:a.id,entity:a._type});this.objectRemoved(a);return this};b.clean=function(){this.trackedObjects={};this.objectsToRemove={};this.objectsRemoved=[];this.globalPropertyListeners={};this.queryCollectionCache={}};b.asyncForEach=function(a,c,h){function g(){var y=a.pop();c(y,function(G,
j){a.length>0?g():h(G,j)})}a=a.slice(0);a.length>0?g():h()};b.asyncParForEach=function(a,c,h){var g=0;a.length===0&&h();for(var y=0;y<a.length;y++)c(a[y],function(G,j){g++;g===a.length&&h(G,j)})};b.jsonToEntityVal=function(a,c){if(c)switch(c){case "DATE":return new Date(a*1E3);default:return a}else return a};b.entityValToJson=function(a,c){if(c)switch(c){case "DATE":if(a){a=new Date(a);return Math.round(a.getTime()/1E3)}else return null;default:return a}else return a};b.dump=function(a,c,h){var g=
C.getArgs(arguments,[{name:"tx",optional:true,check:b.isTransaction,defaultValue:null},{name:"entities",optional:true,check:function(j){return!j||j&&j.length&&!j.apply},defaultValue:null},{name:"callback",optional:false,check:C.isCallback(),defaultValue:function(){}}]);a=g.tx;c=g.entities;h=g.callback;if(!c){c=[];for(var y in K)K.hasOwnProperty(y)&&c.push(K[y])}var G={};b.asyncParForEach(c,function(j,n){j.all().list(a,function(q){var k=[];b.asyncParForEach(q,function(x,z){var w={},p=j.meta.fields;
for(var v in p)if(p.hasOwnProperty(v))w[v]=b.entityValToJson(x._data[v],p[v]);p=j.meta.hasOne;for(var s in p)if(p.hasOwnProperty(s))w[s]=x._data[s];s=j.meta.hasMany;p=[];for(var M in s)s.hasOwnProperty(M)&&p.push(M);b.asyncParForEach(p,function(O,P){b.get(x,O).list(a,function(J){w[O]=J.map(function(Q){return Q.id});P()})},function(){w.id=x.id;k.push(w);z()})},function(){G[j.meta.name]=k;n()})})},function(){h(G)})};b.load=function(a,c,h){var g=C.getArgs(arguments,[{name:"tx",optional:true,check:b.isTransaction,
defaultValue:null},{name:"dump",optional:false},{name:"callback",optional:true,check:C.isCallback(),defaultValue:function(){}}]);a=g.tx;c=g.dump;h=g.callback;var y=[],G=this;for(var j in c)if(c.hasOwnProperty(j)){var n=N(j);g=n.meta.fields;for(var q=c[j],k=0;k<q.length;k++){var x=q[k],z=new n;z.id=x.id;for(var w in x)if(x.hasOwnProperty(w))if(b.isImmutable(w))z[w]=x[w];else if(n.meta.hasMany[w]){var p=n.meta.hasMany[w];if(!(p.manyToMany&&n.meta.name<p.type.meta.name)){var v=b.get(z,w);x[w].length>
0&&x[w].forEach(function(s){y.push({Entity:n,coll:v,id:s})})}}else b.set(z,w,b.jsonToEntityVal(x[w],g[w]));this.add(z)}}G.flush(a,function(){b.asyncForEach(y,function(s,M){s.Entity.load(G,a,s.id,function(O){s.coll.add(O);M()})},function(){G.flush(a,h)})})};b.dumpToJson=function(a,c,h){var g=C.getArgs(arguments,[{name:"tx",optional:true,check:b.isTransaction,defaultValue:null},{name:"entities",optional:true,check:function(y){return y&&y.length&&!y.apply},defaultValue:null},{name:"callback",optional:false,
check:C.isCallback(),defaultValue:function(){}}]);a=g.tx;c=g.entities;h=g.callback;this.dump(a,c,function(y){h(JSON.stringify(y))})};b.loadFromJson=function(a,c,h){var g=C.getArgs(arguments,[{name:"tx",optional:true,check:b.isTransaction,defaultValue:null},{name:"jsonDump",optional:false},{name:"callback",optional:true,check:C.isCallback(),defaultValue:function(){}}]);a=g.tx;c=g.jsonDump;h=g.callback;this.load(a,JSON.parse(c),h)};b.createUUID=L;r.prototype.unsubscribe=function(){this.obj.removeEventListener(this.eventType,
this.fn)};d.prototype.addEventListener=function(a,c){this.subscribers[a]||(this.subscribers[a]=[]);this.subscribers[a].push(c);return new r(this,a,c)};d.prototype.removeEventListener=function(a,c){for(var h=this.subscribers[a],g=0;g<h.length;g++)if(h[g]==c){this.subscribers[a].splice(g,1);return true}return false};d.prototype.triggerEvent=function(a){if(this.subscribers[a])for(var c in this.subscribers[a])this.subscribers[a].hasOwnProperty(c)&&this.subscribers[a][c].apply(null,arguments)};e.prototype.match=
function(){return true};e.prototype.makeFit=function(){};e.prototype.makeNotFit=function(){};e.prototype.toUniqueString=function(){return"NULL"};e.prototype.subscribeGlobally=function(){};e.prototype.unsubscribeGlobally=function(){};l.prototype.match=function(a){return this.left.match(a)&&this.right.match(a)};l.prototype.makeFit=function(a){this.left.makeFit(a);this.right.makeFit(a)};l.prototype.makeNotFit=function(a){this.left.makeNotFit(a);this.right.makeNotFit(a)};l.prototype.toUniqueString=function(){return this.left.toUniqueString()+
" AND "+this.right.toUniqueString()};l.prototype.subscribeGlobally=function(a,c){this.left.subscribeGlobally(a,c);this.right.subscribeGlobally(a,c)};l.prototype.unsubscribeGlobally=function(a,c){this.left.unsubscribeGlobally(a,c);this.right.unsubscribeGlobally(a,c)};m.prototype.match=function(a){return this.left.match(a)||this.right.match(a)};m.prototype.makeFit=function(a){this.left.makeFit(a);this.right.makeFit(a)};m.prototype.makeNotFit=function(a){this.left.makeNotFit(a);this.right.makeNotFit(a)};
m.prototype.toUniqueString=function(){return this.left.toUniqueString()+" OR "+this.right.toUniqueString()};m.prototype.subscribeGlobally=function(a,c){this.left.subscribeGlobally(a,c);this.right.subscribeGlobally(a,c)};m.prototype.unsubscribeGlobally=function(a,c){this.left.unsubscribeGlobally(a,c);this.right.unsubscribeGlobally(a,c)};f.prototype.match=function(a){var c=this.value;a=b.get(a,this.property);if(c&&c.getTime){c=Math.round(c.getTime()/1E3)*1E3;if(a&&a.getTime)a=Math.round(a.getTime()/
1E3)*1E3}switch(this.operator){case "=":return a===c;case "!=":return a!==c;case "<":return a<c;case "<=":return a<=c;case ">":return a>c;case ">=":return a>=c;case "in":return A(c,a);case "not in":return!A(c,a)}};f.prototype.makeFit=function(a){if(this.operator==="=")b.set(a,this.property,this.value);else throw new Error("Sorry, can't perform makeFit for other filters than =");};f.prototype.makeNotFit=function(a){if(this.operator==="=")b.set(a,this.property,null);else throw new Error("Sorry, can't perform makeNotFit for other filters than =");
};f.prototype.subscribeGlobally=function(a,c){b.subscribeToGlobalPropertyListener(a,c,this.property)};f.prototype.unsubscribeGlobally=function(a,c){b.unsubscribeFromGlobalPropertyListener(a,c,this.property)};f.prototype.toUniqueString=function(){var a=this.value;if(a&&a._type)a=a.id;return this.property+this.operator+a};b.NullFilter=e;b.AndFilter=l;b.OrFilter=m;b.PropertyFilter=f;b.uniqueQueryCollection=function(a){var c=a._entityName;if(a._items)return a;this.queryCollectionCache[c]||(this.queryCollectionCache[c]=
{});var h=a.toUniqueString();this.queryCollectionCache[c][h]||(this.queryCollectionCache[c][h]=a);return this.queryCollectionCache[c][h]};i.prototype=new d;i.prototype.oldAddEventListener=i.prototype.addEventListener;i.prototype.setupSubscriptions=function(){this._filter.subscribeGlobally(this,this._entityName)};i.prototype.teardownSubscriptions=function(){this._filter.unsubscribeGlobally(this,this._entityName)};i.prototype.addEventListener=function(a,c){var h=this;c=this.oldAddEventListener(a,c);
this.subscribers[a].length===1&&this.setupSubscriptions();c.oldUnsubscribe=c.unsubscribe;c.unsubscribe=function(){this.oldUnsubscribe();h.subscribers[a].length===0&&h.teardownSubscriptions()};return c};i.prototype.persistQueries=function(){return[]};i.prototype.init=function(a,c,h){this._filter=new e;this._orderColumns=[];this._prefetchFields=[];this._entityName=c;this._constructor=h;this._limit=-1;this._skip=0;this._reverse=false;this._session=a||b;this.subscribers={}};i.prototype.toUniqueString=
function(){var a=this._constructor.name+": "+this._entityName;a+="|Filter:";var c=[];a+=this._filter.toUniqueString();a+="|Values:";for(var h=0;h<c.length;h++)a+=c+"|^|";a+="|Order:";for(h=0;h<this._orderColumns.length;h++){c=this._orderColumns[h];a+=c[0]+", "+c[1]}a+="|Prefetch:";for(h=0;h<this._prefetchFields.length;h++)a+=this._prefetchFields[h];a+="|Limit:";a+=this._limit;a+="|Skip:";a+=this._skip;a+="|Reverse:";a+=this._reverse;return a};i.prototype.clone=function(a){var c=new this._constructor(this._session,
this._entityName);c._filter=this._filter;c._prefetchFields=this._prefetchFields.slice(0);c._orderColumns=this._orderColumns.slice(0);c._limit=this._limit;c._skip=this._skip;c._reverse=this._reverse;if(a){a={};for(var h in this.subscribers)if(this.subscribers.hasOwnProperty(h))a[h]=this.subscribers[h].slice(0);c.subscribers=a}else c.subscribers=this.subscribers;return c};i.prototype.filter=function(a,c,h){var g=this.clone(true);g._filter=new l(this._filter,new f(a,c,h));a=this._session;g=a.uniqueQueryCollection(g);
return a.uniqueQueryCollection(g)};i.prototype.or=function(a){var c=this.clone(true);c._filter=new m(this._filter,a);return this._session.uniqueQueryCollection(c)};i.prototype.and=function(a){var c=this.clone(true);c._filter=new l(this._filter,a);return this._session.uniqueQueryCollection(c)};i.prototype.order=function(a,c){c=c===undefined?true:c;var h=this.clone();h._orderColumns.push([a,c]);return this._session.uniqueQueryCollection(h)};i.prototype.limit=function(a){var c=this.clone();c._limit=
a;return this._session.uniqueQueryCollection(c)};i.prototype.skip=function(a){var c=this.clone();c._skip=a;return this._session.uniqueQueryCollection(c)};i.prototype.reverse=function(){var a=this.clone();a._reverse=true;return this._session.uniqueQueryCollection(a)};i.prototype.prefetch=function(a){var c=this.clone();c._prefetchFields.push(a);return this._session.uniqueQueryCollection(c)};i.prototype.selectJSON=function(a,c,h){var g=C.getArgs(arguments,[{name:"tx",optional:true,check:b.isTransaction,
defaultValue:null},{name:"props",optional:false},{name:"callback",optional:false}]),y=this._session,G=this;a=g.tx;c=g.props;h=g.callback;if(a){N(this._entityName);this.list(function(j){var n=[];b.asyncForEach(j,function(q,k){q.selectJSON(a,c,function(x){n.push(x);k()})},function(){h(n)})})}else y.transaction(function(j){G.selectJSON(j,c,h)})};i.prototype.add=function(a){if(!a.id||!a._type)throw new Error("Cannot add object of non-entity type onto collection.");this._session.add(a);this._filter.makeFit(a);
this.triggerEvent("add",this,a);this.triggerEvent("change",this,a)};i.prototype.remove=function(a){if(!a.id||!a._type)throw new Error("Cannot remove object of non-entity type from collection.");this._filter.makeNotFit(a);this.triggerEvent("remove",this,a);this.triggerEvent("change",this,a)};i.prototype.each=function(a,c){var h=C.getArgs(arguments,[{name:"tx",optional:true,check:b.isTransaction,defaultValue:null},{name:"eachFn",optional:true,check:C.isCallback()}]);a=h.tx;c=h.eachFn;this.list(a,function(g){for(var y=
0;y<g.length;y++)c(g[y])})};i.prototype.forEach=i.prototype.each;i.prototype.one=function(a,c){var h=C.getArgs(arguments,[{name:"tx",optional:true,check:b.isTransaction,defaultValue:null},{name:"oneFn",optional:false,check:C.isCallback()}]);a=h.tx;c=h.oneFn;this.limit(1).list(a,function(g){g.length===0?c(null):c(g[0])})};o.prototype=new i;E.prototype=new o;E.prototype.add=function(a){this._session.add(a);this.triggerEvent("add",this,a);this.triggerEvent("change",this,a)};E.prototype.remove=function(a){this._session.remove(a);
this.triggerEvent("remove",this,a);this.triggerEvent("change",this,a)};B.prototype=new o;B.prototype.initManyToMany=function(a,c){this._obj=a;this._coll=c};B.prototype.add=function(a){if(!A(this._localAdded,a)){this._session.add(a);this._localAdded.push(a);this.triggerEvent("add",this,a);this.triggerEvent("change",this,a)}};B.prototype.clone=function(){var a=o.prototype.clone.call(this);a._localAdded=this._localAdded;a._localRemoved=this._localRemoved;a._obj=this._obj;a._coll=this._coll;return a};
B.prototype.remove=function(a){if(A(this._localAdded,a))t(this._localAdded,a);else A(this._localRemoved,a)||this._localRemoved.push(a);this.triggerEvent("remove",this,a);this.triggerEvent("change",this,a)};D.prototype=new i;D.prototype.clone=function(){var a=o.prototype.clone.call(this);a._items=this._items;return a};D.prototype.add=function(a){if(!A(this._items,a)){this._session.add(a);this._items.push(a);this.triggerEvent("add",this,a);this.triggerEvent("change",this,a)}};D.prototype.remove=function(a){for(var c=
this._items,h=0;h<c.length;h++)if(c[h]===a){this._items.splice(h,1);this.triggerEvent("remove",this,a);this.triggerEvent("change",this,a)}};D.prototype.list=function(a,c){c=C.getArgs(arguments,[{name:"tx",optional:true,check:b.isTransaction,defaultValue:null},{name:"callback",optional:true,check:C.isCallback()}]).callback;if(!c||c.executeSql)c=arguments[1];for(var h=this._items.slice(0),g=this,y=[],G=0;G<h.length;G++)this._filter.match(h[G])&&y.push(h[G]);y.sort(function(j,n){for(var q=0;q<g._orderColumns.length;q++){var k=
g._orderColumns[q][0],x=g._orderColumns[q][1],z=b.get(j,k);k=b.get(n,k);if(z<k)return x?-1:1;else if(z>k)return x?1:-1}return 0});this._skip&&y.splice(0,this._skip);if(this._limit>-1)y=y.slice(0,this._limit);this._reverse&&y.reverse();if(c)c(y);else return y};D.prototype.destroyAll=function(a,c){if(!a||a.executeSql)a=c;this._items=[];this.triggerEvent("change",this);a&&a()};D.prototype.count=function(a,c){var h=C.getArgs(arguments,[{name:"tx",optional:true,check:b.isTransaction,defaultValue:null},
{name:"callback",optional:true,check:C.isCallback()}]);a=h.tx;c=h.callback;h=this.list();if(c)c(h.length);else return h.length};b.QueryCollection=i;b.DbQueryCollection=o;b.ManyToManyDbQueryCollection=B;b.LocalQueryCollection=D;b.Observable=d;b.Subscription=r;b.AndFilter=l;b.OrFilter=m;b.PropertyFilter=f})();var C={};(function(){C.getArgs=function(H,I){for(var N=0,L=0,u={};L<I.length;){var A=I[L],t=H[N];if(A.optional){if(t!==undefined&&A.check(t)){u[A.name]=t;N++}else if(A.defaultValue!==undefined)u[A.name]=
A.defaultValue;L++}else{if(A.check&&!A.check(t))throw new Error("Invalid value for argument: "+A.name+" Value: "+t);u[A.name]=t;L++;N++}}return u};C.hasProperty=function(H){return function(I){return I&&I[H]!==undefined}};C.hasType=function(H){return function(I){return typeof I===H}};C.isCallback=function(){return function(H){return H&&H.apply}}})();b.argspec=C;return b}if(typeof JSON==="undefined")JSON={};
JSON.stringify||function(){function b(r){return r<10?"0"+r:r}function C(r){N.lastIndex=0;return N.test(r)?'"'+r.replace(N,function(d){var e=A[d];return typeof e==="string"?e:"\\u"+("0000"+d.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+r+'"'}function H(r,d){var e,l,m=L,f,i=d[r];if(i&&typeof i==="object"&&typeof i.toJSON==="function")i=i.toJSON(r);if(typeof t==="function")i=t.call(d,r,i);switch(typeof i){case "string":return C(i);case "number":return isFinite(i)?String(i):"null";case "boolean":case "null":return String(i);
case "object":if(!i)return"null";L+=u;f=[];if(Object.prototype.toString.apply(i)==="[object Array]"){l=i.length;for(r=0;r<l;r+=1)f[r]=H(r,i)||"null";d=f.length===0?"[]":L?"[\n"+L+f.join(",\n"+L)+"\n"+m+"]":"["+f.join(",")+"]";L=m;return d}if(t&&typeof t==="object"){l=t.length;for(r=0;r<l;r+=1){e=t[r];if(typeof e==="string")if(d=H(e,i))f.push(C(e)+(L?": ":":")+d)}}else for(e in i)if(Object.hasOwnProperty.call(i,e))if(d=H(e,i))f.push(C(e)+(L?": ":":")+d);d=f.length===0?"{}":L?"{\n"+L+f.join(",\n"+L)+
"\n"+m+"}":"{"+f.join(",")+"}";L=m;return d}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var I=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
N=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,L,u,A={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},t;if(typeof JSON.stringify!=="function")JSON.stringify=function(r,d,e){var l;u=L="";if(typeof e==="number")for(l=0;l<e;l+=1)u+=" ";else if(typeof e==="string")u=e;if((t=d)&&typeof d!=="function"&&(typeof d!=="object"||typeof d.length!=="number"))throw new Error("JSON.stringify");return H("",
{"":r})};if(typeof JSON.parse!=="function")JSON.parse=function(r,d){function e(l,m){var f,i,o=l[m];if(o&&typeof o==="object")for(f in o)if(Object.hasOwnProperty.call(o,f)){i=e(o,f);if(i!==undefined)o[f]=i;else delete o[f]}return d.call(l,m,o)}I.lastIndex=0;if(I.test(r))r=r.replace(I,function(l){return"\\u"+("0000"+l.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(r.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){r=eval("("+r+")");return typeof d==="function"?e({"":r},""):r}throw new SyntaxError("JSON.parse");}}();try{window||(window={})}catch(e$$2){window={};exports.console=console}var persistence=window&&window.persistence?window.persistence:{};if(!persistence.store)persistence.store={};persistence.store.sql={};
persistence.store.sql.config=function(b,C){function H(d,e,l,m){m=m||"";if(d.trackedObjects[l[m+"id"]])return d.trackedObjects[l[m+"id"]];var f=b.typeMapper,i=b.getMeta(e);e=b.define(e);if(!l[m+"id"])return null;d=new e(d,undefined,true);d.id=f.dbValToEntityVal(l[m+"id"],f.idType);d._new=false;for(var o in l)if(l.hasOwnProperty(o))if(o.substring(0,m.length)===m){e=o.substring(m.length);if(e!="id")d._data[e]=f.dbValToEntityVal(l[o],i.fields[e]||f.idType)}return d}function I(d,e,l){var m=b.getMeta(d._type),
f=b.typeMapper,i=[],o=[],E=[],B=[];if(d._new)for(var D in m.fields)if(m.fields.hasOwnProperty(D))d._dirtyProperties[D]=true;for(D in d._dirtyProperties)if(d._dirtyProperties.hasOwnProperty(D)){i.push("`"+D+"`");var F=m.fields[D]||f.idType;o.push(f.entityValToDbVal(d._data[D],F));E.push(f.outVar("?",F));B.push("`"+D+"` = "+f.outVar("?",F))}F=[];for(D in m.hasMany)if(m.hasMany.hasOwnProperty(D))F=F.concat(b.get(d,D).persistQueries());L(e,F,function(){if(i.length===0)l&&l();else{d._dirtyProperties={};
if(d._new){i.push("id");o.push(f.entityIdToDbId(d.id));E.push(f.outIdVar("?"));var K="INSERT INTO `"+d._type+"` ("+i.join(", ")+") VALUES ("+E.join(", ")+")";d._new=false}else K="UPDATE `"+d._type+"` SET "+B.join(",")+" WHERE id = "+f.outId(d.id);e.executeSql(K,o,l,l)}})}function N(d,e,l){var m=b.getMeta(d._type),f=b.typeMapper,i=[["DELETE FROM `"+d._type+"` WHERE id = "+f.outId(d.id),null]];for(var o in m.hasMany)m.hasMany.hasOwnProperty(o)&&m.hasMany[o].manyToMany&&i.push(["DELETE FROM `"+m.hasMany[o].tableName+
"` WHERE `"+m.name+"_"+o+"` = "+f.outId(d.id),null]);L(e,i,l)}function L(d,e,l){for(var m=[],f=3;f<arguments.length;f++)m.push(arguments[f]);b.asyncForEach(e,function(i,o){d.executeSql(i[0],i[1],o,function(E,B){console.log(B.message);o(E,B)})},function(i,o){if(o&&l)l(i,o);else l&&l.apply(null,m)})}var u=b.argspec;b.typeMapper={idType:"VARCHAR(32)",classNameType:"TEXT",columnType:function(d){switch(d){case "JSON":return"TEXT";case "BOOL":return"INT";case "DATE":return"INT";default:return d}},inVar:function(d){return d},
outVar:function(d){return d},outId:function(d){return"'"+d+"'"},dbValToEntityVal:function(d,e){if(d===null||d===undefined)return d;switch(e){case "DATE":return new Date(parseInt(d,10)*1E3);case "BOOL":return d===1||d==="1";case "INT":return+d;case "BIGINT":return+d;case "JSON":return d?JSON.parse(d):d;default:return d}},entityValToDbVal:function(d,e){if(d===undefined||d===null)return null;else if(e==="JSON"&&d)return JSON.stringify(d);else if(d.id)return d.id;else if(e==="BOOL")return d==="false"?
0:d?1:0;else if(e==="DATE"||d.getTime){d=new Date(d);return Math.round(d.getTime()/1E3)}else return d},inIdVar:function(d){return this.inVar(d,this.idType)},outIdVar:function(d){return this.outVar(d,this.idType)},entityIdToDbId:function(d){return this.entityValToDbVal(d,this.idType)}};b.generatedTables={};b.schemaSync=function(d,e,l){var m=u.getArgs(arguments,[{name:"tx",optional:true,check:b.isTransaction,defaultValue:null},{name:"callback",optional:true,check:u.isCallback(),defaultValue:function(){}},
{name:"emulate",optional:true,check:u.hasType("boolean")}]);d=m.tx;e=m.callback;l=m.emulate;if(d){m=[];var f,i,o,E,B=b.typeMapper,D=b.getEntityMeta();for(var F in D)if(D.hasOwnProperty(F)){f=D[F];if(!f.isMixin){i=[];for(var K in f.fields)f.fields.hasOwnProperty(K)&&i.push([K,f.fields[K]]);for(var a in f.hasOne)if(f.hasOne.hasOwnProperty(a)){o=f.hasOne[a].type.meta;i.push([a,B.idType]);m.push([C.createIndex(f.name,[a]),null])}for(o=0;o<f.indexes.length;o++)m.push([C.createIndex(f.name,f.indexes[o].columns,
f.indexes[o]),null])}for(a in f.hasMany)if(f.hasMany.hasOwnProperty(a)&&f.hasMany[a].manyToMany){E=f.hasMany[a].tableName;if(!b.generatedTables[E]){o=f.hasMany[a].type.meta;var c=f.hasMany[a].inverseProperty;if(o.hasMany[c].type.meta==f){var h=f.name+"_"+a;c=o.name+"_"+c;m.push([C.createIndex(E,[h]),null]);m.push([C.createIndex(E,[c]),null]);var g=[[h,B.idType],[c,B.idType]];f.isMixin&&g.push([h+"_class",B.classNameType]);o.isMixin&&g.push([c+"_class",B.classNameType]);m.push([C.createTable(E,g),
null]);b.generatedTables[E]=true}}}if(!f.isMixin){i.push(["id",B.idType,"PRIMARY KEY"]);b.generatedTables[f.name]=true;m.push([C.createTable(f.name,i),null])}}i=b.schemaSyncHooks;for(o=0;o<i.length;o++)i[o](d);l?e(d):L(d,m,function(G,j){e(d,j)})}else{var y=this;this.transaction(function(G){y.schemaSync(G,e,l)})}};b.flush=function(d,e){var l=u.getArgs(arguments,[{name:"tx",optional:true,check:b.isTransaction},{name:"callback",optional:true,check:u.isCallback(),defaultValue:null}]);d=l.tx;e=l.callback;
var m=this;d?b.asyncForEach(b.flushHooks,function(f,i){f(m,d,i)},function(){var f=[];for(var i in m.trackedObjects)m.trackedObjects.hasOwnProperty(i)&&f.push(m.trackedObjects[i]);var o=[];for(i in m.objectsToRemove)if(m.objectsToRemove.hasOwnProperty(i)){o.push(m.objectsToRemove[i]);delete m.trackedObjects[i]}m.objectsToRemove={};if(e)b.asyncParForEach(o,function(E,B){N(E,d,B)},function(E,B){if(B)return e(E,B);b.asyncParForEach(f,function(D,F){I(D,d,F)},e)});else{for(i=0;i<f.length;i++)I(f[i],d);
for(i=0;i<o.length;i++)N(o[i],d)}}):this.transaction(function(f){m.flush(f,e)})};b.reset=function(d,e){var l=u.getArgs(arguments,[{name:"tx",optional:true,check:b.isTransaction,defaultValue:null},{name:"callback",optional:true,check:u.isCallback(),defaultValue:function(){}}]);d=l.tx;e=l.callback;var m=this;d?this.schemaSync(d,function(){function f(){var B=o.pop();d.executeSql("DROP TABLE IF EXISTS `"+B+"`",null,function(){o.length>0?f():i()},i)}function i(B,D){m.clean();b.generatedTables={};e&&e(B,
D)}var o=[];for(var E in b.generatedTables)b.generatedTables.hasOwnProperty(E)&&o.push(E);o.length>0?f():i()},true):m.transaction(function(f){m.reset(f,e)})};b.save=I;b.executeQueriesSeq=L;b.QueryCollection.prototype.persistQueries=function(){return[]};var A=b.QueryCollection.prototype.clone;b.QueryCollection.prototype.clone=function(d){d=A.call(this,d);d._additionalJoinSqls=this._additionalJoinSqls.slice(0);d._additionalWhereSqls=this._additionalWhereSqls.slice(0);d._additionalGroupSqls=this._additionalGroupSqls.slice(0);
d._manyToManyFetch=this._manyToManyFetch;return d};var t=b.QueryCollection.prototype.init;b.QueryCollection.prototype.init=function(d,e,l){t.call(this,d,e,l);this._manyToManyFetch=null;this._additionalJoinSqls=[];this._additionalWhereSqls=[];this._additionalGroupSqls=[]};var r=b.QueryCollection.prototype.toUniqueString;b.QueryCollection.prototype.toUniqueString=function(){var d=r.call(this);d+="|JoinSQLs:";for(var e=0;e<this._additionalJoinSqls.length;e++)d+=this._additionalJoinSqls[e];d+="|WhereSQLs:";
for(e=0;e<this._additionalWhereSqls.length;e++)d+=this._additionalWhereSqls[e];d+="|GroupSQLs:";for(e=0;e<this._additionalGroupSqls.length;e++)d+=this._additionalGroupSqls[e];if(this._manyToManyFetch){d+="|ManyToManyFetch:";d+=JSON.stringify(this._manyToManyFetch)}return d};b.NullFilter.prototype.sql=function(){return"1=1"};b.AndFilter.prototype.sql=function(d,e,l){return"("+this.left.sql(d,e,l)+" AND "+this.right.sql(d,e,l)+")"};b.OrFilter.prototype.sql=function(d,e,l){return"("+this.left.sql(d,
e,l)+" OR "+this.right.sql(d,e,l)+")"};b.PropertyFilter.prototype.sql=function(d,e,l){var m=b.typeMapper;e=e?"`"+e+"`.":"";d=d.fields[this.property]||m.idType;if(this.operator==="="&&this.value===null)return e+"`"+this.property+"` IS NULL";else if(this.operator==="!="&&this.value===null)return e+"`"+this.property+"` IS NOT NULL";else if(this.operator==="in"){for(var f=this.value,i=[],o=0;o<f.length;o++){i.push("?");l.push(m.entityValToDbVal(f[o],d))}return f.length===0?"1 = 0":e+"`"+this.property+
"` IN ("+i.join(", ")+")"}else if(this.operator==="not in"){f=this.value;i=[];for(o=0;o<f.length;o++){i.push("?");l.push(m.entityValToDbVal(f[o],d))}return f.length===0?"1 = 1":e+"`"+this.property+"` NOT IN ("+i.join(", ")+")"}else{f=this.value;if(f===true||f===false)f=f?1:0;l.push(m.entityValToDbVal(f,d));return e+"`"+this.property+"` "+this.operator+" "+m.outVar("?",d)}};b.DbQueryCollection.prototype.list=function(d,e){function l(n,q,k){var x=[B.inIdVar("`"+q+"`.id")+" AS "+k+"id"];for(var z in n.fields)n.fields.hasOwnProperty(z)&&
x.push(B.inVar("`"+q+"`.`"+z+"`",n.fields[z])+" AS `"+k+z+"`");for(z in n.hasOne)n.hasOne.hasOwnProperty(z)&&x.push(B.inIdVar("`"+q+"`.`"+z+"`")+" AS `"+k+z+"`");return x}var m=u.getArgs(arguments,[{name:"tx",optional:true,check:b.isTransaction,defaultValue:null},{name:"callback",optional:false,check:u.isCallback()}]);d=m.tx;e=m.callback;var f=this,i=this._session;if(d){var o=this._entityName,E=b.getMeta(o),B=b.typeMapper;if(E.isMixin){var D=[];b.asyncForEach(E.mixedIns,function(n,q){var k=f.clone();
k._entityName=n.name;k.list(d,function(x){D=D.concat(x);q()})},function(){var n=new b.LocalQueryCollection(D);n._orderColumns=f._orderColumns;n._reverse=f._reverse;n.list(null,e)})}else{m=[];var F=o+"_",K=l(E,"root",F),a="",c=this._additionalWhereSqls.slice(0),h=this._manyToManyFetch;if(h){a+="LEFT JOIN `"+h.table+"` AS mtm ON mtm.`"+h.inverseProp+"` = `root`.`id` ";c.push("mtm.`"+h.prop+"` = "+B.outId(h.id))}a+=this._additionalJoinSqls.join(" ");for(h=0;h<this._prefetchFields.length;h++){var g=this._prefetchFields[h],
y=E.hasOne[g].type.meta;if(y.isMixin)throw new Error("cannot prefetch a mixin");var G=y.name+"_"+g+"_tbl";K=K.concat(l(y,G,g+"_"));a+="LEFT JOIN `"+y.name+"` AS `"+G+"` ON `"+G+"`.`id` = `root`.`"+g+"` "}c="WHERE "+[this._filter.sql(E,"root",m)].concat(c).join(" AND ");var j="SELECT "+K.join(", ")+" FROM `"+o+"` AS `root` "+a+" "+c;if(this._additionalGroupSqls.length>0)j+=this._additionalGroupSqls.join(" ");if(this._orderColumns.length>0)j+=" ORDER BY "+this._orderColumns.map(function(n){return"`"+
F+n[0]+"` "+(n[1]?"ASC":"DESC")}).join(", ");if(this._limit>=0)j+=" LIMIT "+this._limit;if(this._skip>0)j+=" OFFSET "+this._skip;i.flush(d,function(){d.executeSql(j,m,function(n){var q=[];f._reverse&&n.reverse();for(var k=0;k<n.length;k++){for(var x=n[k],z=H(i,o,x,F),w=0;w<f._prefetchFields.length;w++){var p=f._prefetchFields[w];z._data_obj[p]=H(i,E.hasOne[p].type.meta.name,x,p+"_");i.add(z._data_obj[p])}q.push(z);i.add(z)}e(q);f.triggerEvent("list",f,q)})})}}else i.transaction(function(n){f.list(n,
e)})};b.DbQueryCollection.prototype.destroyAll=function(d,e){var l=u.getArgs(arguments,[{name:"tx",optional:true,check:b.isTransaction,defaultValue:null},{name:"callback",optional:true,check:u.isCallback(),defaultValue:function(){}}]);d=l.tx;e=l.callback;var m=this,f=this._session;if(d){var i=this._entityName,o=b.getMeta(i),E=b.typeMapper;if(o.isMixin)b.asyncForEach(o.mixedIns,function(h){var g=m.clone();g._entityName=h.name;g.destroyAll(d,e)},e);else{var B="",D=this._additionalWhereSqls.slice(0),
F=this._manyToManyFetch;if(F){B+="LEFT JOIN `"+F.table+"` AS mtm ON mtm.`"+F.inverseProp+"` = `root`.`id` ";D.push("mtm.`"+F.prop+"` = "+E.outId(F.id))}B+=this._additionalJoinSqls.join(" ");l=[];o="WHERE "+[this._filter.sql(o,null,l)].concat(D).join(" AND ");var K="SELECT id FROM `"+i+"` "+B+" "+o,a="DELETE FROM `"+i+"` "+B+" "+o,c=l.slice(0);f.flush(d,function(){d.executeSql(K,l,function(h){for(var g=0;g<h.length;g++){delete f.trackedObjects[h[g].id];f.objectsRemoved.push({id:h[g].id,entity:i})}m.triggerEvent("change",
m);d.executeSql(a,c,e,e)},e)})}}else f.transaction(function(h){m.destroyAll(h,e)})};b.DbQueryCollection.prototype.count=function(d,e){var l=u.getArgs(arguments,[{name:"tx",optional:true,check:b.isTransaction,defaultValue:null},{name:"callback",optional:false,check:u.isCallback()}]);d=l.tx;e=l.callback;var m=this,f=this._session;if(d&&!d.executeSql){e=d;d=null}if(d){var i=this._entityName,o=b.getMeta(i),E=b.typeMapper;if(o.isMixin){var B=0;b.asyncForEach(o.mixedIns,function(c,h){var g=m.clone();g._entityName=
c.name;g.count(d,function(y){B+=y;h()})},function(){e(B)})}else{var D="",F=this._additionalWhereSqls.slice(0),K=this._manyToManyFetch;if(K){D+="LEFT JOIN `"+K.table+"` AS mtm ON mtm.`"+K.inverseProp+"` = `root`.`id` ";F.push("mtm.`"+K.prop+"` = "+E.outId(K.id))}D+=this._additionalJoinSqls.join(" ");l=[];o="WHERE "+[this._filter.sql(o,"root",l)].concat(F).join(" AND ");var a="SELECT COUNT(*) AS cnt FROM `"+i+"` AS `root` "+D+" "+o;f.flush(d,function(){d.executeSql(a,l,function(c){e(parseInt(c[0].cnt,
10))})})}}else f.transaction(function(c){m.count(c,e)})};b.ManyToManyDbQueryCollection.prototype.persistQueries=function(){for(var d=[],e=b.getMeta(this._obj._type),l=e.hasMany[this._coll].type.meta,m=b.typeMapper,f=e.hasMany[this._coll],i=l.hasMany[f.inverseProperty],o=f.mixin?f.mixin.meta.name:e.name,E=i.mixin?i.mixin.meta.name:l.name,B=0;B<this._localAdded.length;B++){var D=[o+"_"+this._coll,E+"_"+f.inverseProperty],F=[m.outIdVar("?"),m.outIdVar("?")],K=[m.entityIdToDbId(this._obj.id),m.entityIdToDbId(this._localAdded[B].id)];
if(f.mixin){D.push(o+"_"+this._coll+"_class");F.push("?");K.push(e.name)}if(i.mixin){D.push(E+"_"+f.inverseProperty+"_class");F.push("?");K.push(l.name)}d.push(["INSERT INTO "+f.tableName+" (`"+D.join("`, `")+"`) VALUES ("+F.join(",")+")",K])}this._localAdded=[];for(B=0;B<this._localRemoved.length;B++)d.push(["DELETE FROM  "+f.tableName+" WHERE `"+o+"_"+this._coll+"` = "+m.outIdVar("?")+" AND `"+E+"_"+f.inverseProperty+"` = "+m.outIdVar("?"),[m.entityIdToDbId(this._obj.id),m.entityIdToDbId(this._localRemoved[B].id)]]);
this._localRemoved=[];return d}};try{exports.config=persistence.store.sql.config}catch(e$$4){}try{window||(window={})}catch(e$$5){window={};exports.console=console}persistence=window&&window.persistence?window.persistence:{};if(!persistence.store)persistence.store={};persistence.store.websql={};
persistence.store.websql.config=function(b,C,H,I){var N=null;b.transaction=function(u){if(N)N.transaction(u);else throw new Error("No ongoing database connection, please connect first.");};b.db=b.db||{};b.db.implementation="unsupported";b.db.conn=null;if(typeof Titanium!=="undefined")b.db.implementation="titanium";else if(window&&window.openDatabase)b.db.implementation="html5";else if(window&&window.google&&google.gears)b.db.implementation="gears";else try{if(openDatabaseSync)b.db.implementation=
"html5-sync"}catch(L){}b.db.html5={};b.db.html5.connect=function(u,A,t){var r={},d=openDatabase(u,"1.0",A,t);r.transaction=function(e){return d.transaction(function(l){return e(b.db.html5.transaction(l))})};return r};b.db.html5.transaction=function(u){var A={};A.executeSql=function(t,r,d,e){b.debug&&console.log(t,r);u.executeSql(t,r,function(l,m){if(d){l=[];for(var f=0;f<m.rows.length;f++)l.push(m.rows.item(f));d(l)}},e)};return A};b.db.html5Sync={};b.db.html5Sync.connect=function(u,A,t){var r={},
d=openDatabaseSync(u,"1.0",A,t);r.transaction=function(e){return d.transaction(function(l){return e(b.db.html5Sync.transaction(l))})};return r};b.db.html5Sync.transaction=function(u){var A={};A.executeSql=function(t,r,d){if(r==null)r=[];b.debug&&console.log(t,r);if(t=u.executeSql(t,r))if(d){r=[];for(var e=0;e<t.rows.length;e++)r.push(t.rows.item(e));d(r)}};return A};b.db.gears={};b.db.gears.connect=function(u){var A={},t=google.gears.factory.create("beta.database");t.open(u);A.transaction=function(r){r(b.db.gears.transaction(t))};
return A};b.db.gears.transaction=function(u){var A={};A.executeSql=function(t,r,d){b.debug&&console.log(t,r);t=u.execute(t,r);if(d){for(r=[];t.isValidRow();){for(var e={},l=0;l<t.fieldCount();l++)e[t.fieldName(l)]=t.field(l);r.push(e);t.next()}d(r)}};return A};b.db.titanium={};b.db.titanium.connect=function(u){var A={},t=Titanium.Database.open(u);A.transaction=function(r){r(b.db.titanium.transaction(t))};return A};b.db.titanium.transaction=function(u){var A={};A.executeSql=function(t,r,d,e){b.debug&&
console.log(t,r);try{t=[t];if(r)t=t.concat(r);var l=Function.apply.call(u.execute,u,t);if(l&&d){for(r=[];l.isValidRow();){t={};for(var m=0;m<l.fieldCount();m++)t[l.fieldName(m)]=l.field(m);r.push(t);l.next()}l.close();d(r)}}catch(f){e&&e(null,f)}};return A};b.db.connect=function(u,A,t){if(b.db.implementation=="html5")return b.db.html5.connect(u,A,t);else if(b.db.implementation=="html5-sync")return b.db.html5Sync.connect(u,A,t);else if(b.db.implementation=="gears")return b.db.gears.connect(u);else if(b.db.implementation==
"titanium")return b.db.titanium.connect(u)};b.store.websql.sqliteDialect={createTable:function(u,A){var t=b.typeMapper;u="CREATE TABLE IF NOT EXISTS `"+u+"` (";for(var r=[],d=0;d<A.length;d++){var e=A[d];r.push("`"+e[0]+"` "+t.columnType(e[1])+(e[2]?" "+e[2]:""))}u+=r.join(", ");u+=")";return u},createIndex:function(u,A,t){t=t||{};return"CREATE "+(t.unique?"UNIQUE ":"")+"INDEX IF NOT EXISTS `"+u+"__"+A.join("_")+"` ON `"+u+"` ("+A.map(function(r){return"`"+r+"`"}).join(", ")+")"}};b.store.sql.config(b,
b.store.websql.sqliteDialect);N=b.db.connect(C,H,I);if(!N)throw new Error("No supported database found in this browser.");};try{exports.persistence=persistence}catch(e$$8){};
